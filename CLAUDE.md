# CLAUDE.md - FliDeck

## Project Overview

FliDeck is a **local-first presentation harness** that discovers, mounts, and displays folder-based HTML artifacts generated by Claude Code agents.

**Purpose:** Viewing and navigating generated visual assets without manual file management or browser tab chaos.

**What it is NOT:** A presentation builder, editor, or templating engine.

## Quick Start

```bash
# Install dependencies
npm install

# Start development (both client and server)
npm run dev

# Build for production
npm run build

# Run production server
npm start
```

## Architecture

**Monorepo Structure:**
- `client/` - React 19 + Vite + TailwindCSS (port 5200)
- `server/` - Express 5 + Socket.io + Chokidar (port 5201)
- `shared/` - TypeScript types shared between client/server

## Key Patterns

### Backend Patterns
- **WatcherManager** - Centralized file watching with debouncing
- **PresentationService** - Singleton EventEmitter for discovery/caching
- **Route Factory** - Dependency injection for routes
- **AppError + asyncHandler** - Clean async error handling

### Frontend Patterns
- **TanStack Query** - Server state with Socket.io invalidation
- **Socket.io Hooks** - Connection status, room management
- **React Router** - URL-based navigation

## API Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/presentations` | List all presentations |
| GET | `/api/presentations/:id` | Get single presentation |
| POST | `/api/presentations/refresh` | Force refresh cache |
| GET | `/api/assets/:presentationId/:assetId` | Get asset content |
| GET | `/api/health` | Health check |

## Socket.io Events

| Event | Direction | Description |
|-------|-----------|-------------|
| `presentations:updated` | Server -> Client | File system changed |
| `join:presentation` | Client -> Server | Join presentation room |
| `leave:presentation` | Client -> Server | Leave presentation room |

## File Discovery Rules

1. FliDeck watches `PRESENTATIONS_ROOT` directory
2. Any subfolder containing `index.html` is a valid presentation
3. All `.html` files in the folder are considered assets
4. No manifest required (convention over configuration)

## Environment Variables

| Variable | Default | Description |
|----------|---------|-------------|
| `PORT` | 5201 | Server port |
| `CLIENT_URL` | http://localhost:5200 | CORS origin |
| `PRESENTATIONS_ROOT` | ./presentations | Where to find presentations |
| `NODE_ENV` | development | Environment mode |

## Common Tasks

### Adding a new API endpoint

1. Create route handler in `server/src/routes/`
2. Use `asyncHandler` for async routes
3. Register in `server/src/routes/index.ts`

### Adding a new UI component

1. Create component in `client/src/components/`
2. Use TailwindCSS for styling
3. Import and use in pages

### Adding a new Socket.io event

1. Define event type in `shared/src/types.ts`
2. Emit from server in appropriate location
3. Handle in client using `useSocketInvalidation` hook

## Success Criteria (v0.1.0)

1. App discovers presentations from configured root folder
2. App displays list of available presentations
3. User can select a presentation and see its assets
4. User can switch between assets
5. Assets render correctly with their own styles
6. File changes trigger UI refresh
7. Basic navigation (back, forward, home) works

## Related Documentation

- `docs/planning/requirements.md` - Full requirements specification
- `docs/planning/architecture.md` - Detailed architecture decisions
